# claude-symphony HANDOFF Intelligence Configuration
# Smart context extraction and summarization

smart_handoff:
  enabled: true
  description: "Automatic context extraction and intelligent HANDOFF generation"

  # Auto extraction settings
  auto_extraction:
    enabled: true
    description: "Auto-extract information to include in HANDOFF"

    extract_from:
      completed_tasks:
        enabled: true
        format: "checklist"
        include_timestamps: true

      key_decisions:
        enabled: true
        format: "decision_log"
        include_rationale: true
        include_alternatives: false

      modified_files:
        enabled: true
        format: "file_list"
        include_diff_summary: true
        max_files: 20

      pending_issues:
        enabled: true
        format: "issue_list"
        priority_order: true

      ai_call_history:
        enabled: true
        format: "table"
        include_prompts: false  # Save tokens
        include_results_summary: true

      # Epic Cycle information
      epic_cycle:
        enabled: true
        format: "summary"
        include:
          - current_cycle
          - total_cycles
          - scope_range
          - previous_learnings
        conditional: true  # Only include if epic_cycle.enabled

      # Implementation Order settings
      implementation_order:
        enabled: true
        format: "structured"
        include:
          - selected_order
          - current_phase
          - phase_name
          - reference_links
        conditional: true  # Only include if order is selected

      # Moodboard Analysis data
      moodboard:
        enabled: true
        format: "summary"
        include:
          - design_style
          - analysis_status
          - feedback_iterations
          - collected_categories
          - design_tokens_status
        conditional: true  # Only include if moodboard.active

      # Requirements Refinement state
      requirements_refinement:
        enabled: true
        format: "hierarchy"
        include:
          - current_iteration
          - refined_count
          - validation_status
          - hierarchy_summary
          - pending_refinement
        conditional: true  # Only include if refinement.active

    # Extraction priority (higher = first)
    priority:
      - blocking_issues: 100
      - key_decisions: 90
      - pending_issues: 80
      - epic_cycle: 75
      - requirements_refinement: 72
      - implementation_order: 70
      - modified_files: 65
      - moodboard: 62
      - completed_tasks: 60
      - ai_call_history: 50

  # Compression settings
  compression:
    enabled: true
    strategy: "semantic"
    description: "Semantic-based context compression"

    max_tokens: 4000
    compression_ratio_target: 0.3  # 30% of original

    preserve:
      always:
        - "critical_decisions"
        - "blocking_issues"
        - "current_task"
      conditionally:
        - "file_changes"
        - "test_results"

    summarization:
      enabled: true
      method: "extractive"  # extractive or abstractive
      model: "claude"

  # Context transfer optimization
  context_transfer:
    format: "structured_markdown"

    sections:
      critical:
        title: "Critical Context"
        max_tokens: 1500
        content:
          - blocking_issues
          - critical_decisions

      primary:
        title: "Primary Context"
        max_tokens: 1500
        content:
          - current_task_state
          - key_file_changes
          - next_steps
          - epic_cycle_state

      secondary:
        title: "Secondary Context"
        max_tokens: 1000
        content:
          - completed_tasks_summary
          - ai_call_summary
          - implementation_order
          - requirements_refinement_status

      tertiary:
        title: "Extended Context"
        max_tokens: 800
        content:
          - moodboard_analysis
          - design_tokens_summary
          - previous_cycle_learnings

    # Highlight information immediately needed by next stage
    highlight:
      enabled: true
      marker: "!!"
      content:
        - immediate_actions
        - required_inputs
        - epic_cycle_transition
        - refinement_blockers

# Contextual summarization settings
contextual_summarization:
  enabled: true
  description: "Generate stage-specific customized summaries"

  strategies:
    completed_tasks:
      method: "bullet_points"
      max_items: 10
      grouping: "by_type"  # by_type, by_priority, chronological

    file_changes:
      method: "impact_analysis"
      include:
        - file_path
        - change_type
        - impact_scope
      exclude_patterns:
        - "*.log"
        - "*.tmp"
        - "node_modules/*"

    decisions:
      method: "structured"
      format: |
        **Decision**: {{decision}}
        **Rationale**: {{rationale}}
        **Impact**: {{impact}}

    next_steps:
      method: "actionable"
      format: "numbered_list"
      include_prerequisites: true

    # Epic Cycle summarization
    epic_cycle:
      method: "status_table"
      format: |
        | Property | Value |
        |----------|-------|
        | Current Cycle | {{current}} / {{total}} |
        | Scope | {{start}} → {{end}} |
        | Status | {{status}} |
      include_learnings: true
      max_learnings: 5

    # Implementation Order summarization
    implementation_order:
      method: "phase_summary"
      format: |
        **Order**: {{selected_order}}
        **Phase**: {{phase_number}} - {{phase_name}}
        **Progress**: {{completed_tasks}} / {{total_tasks}}
      include_reference_links: true

    # Moodboard summarization
    moodboard:
      method: "design_summary"
      include:
        - style_direction
        - categories_collected
        - analysis_feedback
        - design_tokens
      format: "compact"

    # Requirements Refinement summarization
    requirements_refinement:
      method: "hierarchy_summary"
      format: |
        **Iteration**: {{iteration}}
        **Hierarchy**: {{epic_count}} Epics → {{feature_count}} Features → {{task_count}} Tasks
        **Validation**: {{validation_status}}
      include_pending: true
      max_pending: 5

  # Stage-specific summary focus
  stage_focus:
    "01-brainstorm":
      emphasize: ["ideas", "requirements", "refinement_candidates"]
      de_emphasize: ["technical_details"]

    "03-planning":
      emphasize: ["architecture", "tech_decisions", "refined_requirements"]
      de_emphasize: ["raw_ideas"]

    "04-ui-ux":
      emphasize: ["moodboard_analysis", "design_tokens", "wireframes"]
      de_emphasize: ["backend_details"]

    "05-task-management":
      emphasize: ["implementation_order", "task_breakdown", "sprint_planning"]
      de_emphasize: ["design_exploration"]

    "06-implementation":
      emphasize: ["code_changes", "technical_decisions", "current_phase"]
      de_emphasize: ["ideation"]

    "08-qa":
      emphasize: ["bugs", "test_results"]
      de_emphasize: ["planning_details"]

    # Epic cycle stage transitions
    "epic_boundary":
      emphasize: ["cycle_learnings", "scope_adjustments", "preserved_context"]
      de_emphasize: ["implementation_details"]

# HANDOFF template settings
templates:
  default:
    sections:
      - name: "Summary"
        required: true
        auto_generate: true

      - name: "Completed Tasks"
        required: true
        auto_generate: true

      - name: "Key Decisions"
        required: true
        auto_generate: true

      - name: "Modified Files"
        required: false
        auto_generate: true

      - name: "Pending Issues"
        required: false
        auto_generate: true

      - name: "Next Steps"
        required: true
        auto_generate: true

      - name: "AI Call History"
        required: false
        auto_generate: true

      # New feature sections (conditional)
      - name: "Epic Cycle Information"
        required: false
        auto_generate: true
        conditional: "epic_cycle.enabled"

      - name: "Implementation Order"
        required: false
        auto_generate: true
        conditional: "implementation_order.selected"

      - name: "Moodboard Analysis"
        required: false
        auto_generate: true
        conditional: "moodboard.active"

      - name: "Requirements Refinement"
        required: false
        auto_generate: true
        conditional: "requirements_refinement.active"

  # Compact template for stage transitions
  compact:
    max_tokens: 2000
    sections:
      - name: "Critical"
        required: true
      - name: "Next Actions"
        required: true
      - name: "Epic Status"
        required: false
        conditional: "epic_cycle.enabled"

  # Detailed template for session recovery
  recovery:
    max_tokens: 6000
    sections:
      - name: "Full Context"
        required: true
      - name: "Step-by-Step Recovery"
        required: true
      - name: "Feature States"
        required: false
        include:
          - epic_cycle
          - implementation_order
          - moodboard
          - requirements_refinement

  # Epic cycle transition template
  epic_transition:
    max_tokens: 4000
    sections:
      - name: "Cycle Summary"
        required: true
        auto_generate: true
      - name: "Learnings & Insights"
        required: true
        auto_generate: true
      - name: "Scope Adjustments"
        required: false
        auto_generate: true
      - name: "Context to Preserve"
        required: true
        auto_generate: true
      - name: "Next Cycle Recommendations"
        required: true
        auto_generate: true

# Quality assurance
quality_assurance:
  validation:
    check_completeness: true
    check_consistency: true
    check_actionability: true

  scoring:
    enabled: true
    criteria:
      - clarity: 0.3
      - completeness: 0.3
      - actionability: 0.4

    minimum_score: 0.7

  auto_improve:
    enabled: true
    max_iterations: 2
    improvement_prompts:
      low_clarity: "Rewrite this section more clearly."
      low_completeness: "Information is missing. Please add: {{missing}}"
      low_actionability: "Convert next steps into more specific actions."
