# AI Model Fallback Strategy
# Principle: Claude=MCP tools, Codex=Pure code analysis, Gemini=Creative tasks

fallback_strategy:
  # NOTE: Use 'claudecode' (coding model) for fallback, not 'claude' (research model)
  # See config/models.yaml for model definitions
  default_fallback: claudecode
  auto_switch: true
  retry_count: 2
  retry_delay_ms: 3000

# Stage-specific primary model (based on MCP usage)
# MCP tools: exa, web_search, context7, playwright, notion, figma, etc.
stage_overrides:
  01-brainstorm:
    primary: gemini      # Creative idea generation
    fallback: claude
    mcp_required: false
    rationale: "Brainstorming benefits from Gemini's creative divergent thinking"

  02-research:
    primary: claude      # Uses exa, web_search MCP tools
    fallback: gemini
    mcp_required: true
    mcp_tools: [exa, web_search]
    rationale: "Research requires MCP tools for web search and data gathering"

  03-planning:
    primary: gemini      # Architecture design (creative)
    fallback: claude
    mcp_required: false
    rationale: "System architecture benefits from creative exploration"

  04-ui-ux:
    primary: gemini      # Design creativity
    fallback: claude
    mcp_required: false  # figma MCP is optional
    mcp_tools: [figma]
    rationale: "UI/UX design requires creative visual thinking"

  05-task-management:
    primary: claude      # Uses notion MCP
    fallback: gemini
    mcp_required: true
    mcp_tools: [notion]
    rationale: "Task management integrates with Notion via MCP"

  06-implementation:
    primary: claude      # Uses context7 MCP for docs
    fallback: codex
    mcp_required: true
    mcp_tools: [context7, serena]
    rationale: "Implementation needs context7 for up-to-date documentation"

  07-refactoring:
    primary: codex       # Pure code analysis/refactoring
    fallback: claude
    mcp_required: false
    rationale: "Refactoring is pure code analysis - Codex specialty"

  08-qa:
    primary: claude      # May use playwright MCP
    fallback: codex
    mcp_required: false  # playwright optional for manual QA
    mcp_tools: [playwright]
    rationale: "QA can benefit from browser automation via playwright"

  09-testing:
    primary: claude      # Uses playwright MCP for E2E tests
    fallback: codex      # Unit tests don't need MCP
    mcp_required: true
    mcp_tools: [playwright]
    rationale: "E2E testing requires playwright MCP for browser automation"

  10-deployment:
    primary: claude      # General task handling
    fallback: codex
    mcp_required: false
    rationale: "Deployment scripts and CI/CD configuration"

# Fallback trigger conditions
triggers:
  - api_failure          # API call failed
  - rate_limit           # Rate limit exceeded
  - quality_threshold_fail  # Output quality below threshold
  - timeout              # Response timeout
  - context_overflow     # Context window exceeded

# Quality thresholds for auto-fallback
quality_thresholds:
  code_quality: 0.7      # Lint/typecheck pass rate
  test_coverage: 0.6     # Minimum coverage for fallback
  response_coherence: 0.8  # Response quality score

# Logging configuration
logging:
  enabled: true
  destination: HANDOFF.md
  log_format: |
    ## AI Model Switch Log
    | Time | From | To | Reason | Stage |
    |------|------|----|---------| ------|

# Model capabilities reference
model_capabilities:
  claude:
    strengths:
      - MCP tool integration
      - Code generation accuracy
      - Context understanding
    weaknesses:
      - Creative brainstorming
    best_for: [implementation, testing, task_management]

  gemini:
    strengths:
      - Creative exploration
      - Rapid ideation
      - Visual thinking
    weaknesses:
      - No MCP integration
    best_for: [brainstorming, planning, ui_ux]

  codex:
    strengths:
      - Deep code analysis
      - Refactoring patterns
      - Code comprehension
    weaknesses:
      - No MCP integration
      - Limited creativity
    best_for: [refactoring, code_review, unit_testing]
