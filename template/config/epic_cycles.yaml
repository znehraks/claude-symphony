# claude-symphony Epic Cycles Configuration
# Enables repeatable stage cycles (Epics) for iterative development

# claude-symphony Epic Cycles Configuration
# Enables repeatable stage cycles (Epics) for iterative development
# NOTE: Enable/disable via /epic enable or /epic disable commands
#       State is stored in progress.json, not in this file

epic_cycles:
  # enabled state is stored in progress.json (not here)
  description: "User-defined stage range repetition for iterative refinement"

  # ============================================
  # Core Cycle Configuration
  # ============================================
  cycle_config:
    default_cycles: 1           # Number of cycles by default
    max_cycles: 5               # Maximum allowed cycles
    allow_mid_project_modification: true  # Allow changing cycle settings during project

  # ============================================
  # Cycle Scope Definition (User-Customizable)
  # ============================================
  cycle_scope:
    # Default scope (can be changed via /epic set-scope)
    start_stage: "01-brainstorm"
    end_stage: "05-task-management"

    # Preset scopes for quick selection
    preset_scopes:
      - name: "ideation"
        description: "Brainstorm to Planning cycle"
        start: "01-brainstorm"
        end: "03-planning"
        use_cases:
          - "Exploring multiple product directions"
          - "Pivoting after initial research"
          - "Refining core concept"

      - name: "design"
        description: "Brainstorm to Task Management cycle"
        start: "01-brainstorm"
        end: "05-task-management"
        use_cases:
          - "Full planning iteration"
          - "Design-first approach"
          - "Complete pre-implementation cycle"

      - name: "full"
        description: "Complete pipeline cycle"
        start: "01-brainstorm"
        end: "10-deployment"
        use_cases:
          - "Multiple release iterations"
          - "Version-based development"
          - "Complete product cycles"

      - name: "implementation"
        description: "Implementation to Testing cycle"
        start: "06-implementation"
        end: "09-testing"
        use_cases:
          - "Feature iteration cycles"
          - "Bug fix cycles"
          - "Performance optimization cycles"

  # ============================================
  # Context Preservation Between Cycles
  # ============================================
  context_preservation:
    enabled: true
    description: "Preserve learnings and decisions across epic cycles"

    # What to preserve between cycles
    preserve:
      - previous_ideas          # Ideas from past cycles
      - rejected_approaches     # What didn't work and why
      - technical_learnings     # Technical insights gained
      - user_feedback           # Accumulated user feedback
      - key_decisions           # Major decisions made
      - blockers_encountered    # Issues hit during cycle

    # Archive location for cycle data
    archive_location: "state/epic_archives"

    # Archive structure
    archive_format:
      directory_pattern: "cycle_{cycle_number}_{timestamp}"
      include:
        - handoffs              # All HANDOFF.md files
        - key_outputs           # Important outputs from each stage
        - decisions_log         # Decisions made in cycle
        - lessons_learned       # What was learned

    # Handoff generation between cycles
    cycle_handoff:
      enabled: true
      template: "state/templates/epic_handoff.md.template"
      auto_generate: true
      include_diff_from_previous: true

  # ============================================
  # Cycle Transition Rules
  # ============================================
  transitions:
    # How to handle cycle completion
    on_cycle_complete:
      - archive_cycle_state       # Archive current cycle data
      - generate_cycle_handoff    # Generate cycle summary
      - prompt_continuation       # Ask user if continuing
      - reset_stage_states        # Reset stage statuses for new cycle

    # What triggers a new cycle
    cycle_triggers:
      - name: "user_request"
        description: "User explicitly requests new cycle"
        command: "/epic new"

      - name: "scope_change"
        description: "Major scope change detected"
        auto_suggest: true
        confirmation_required: true

      - name: "pivot_required"
        description: "Direction change needed"
        auto_suggest: true
        confirmation_required: true

    # Restrictions
    restrictions:
      prevent_cycle_during_implementation: false  # Allow cycling during impl
      require_checkpoint_before_new_cycle: true
      min_stages_completed_for_cycle: 2  # Must complete 2+ stages

  # ============================================
  # Integration with Sprint Mode
  # ============================================
  sprint_integration:
    description: "How epic cycles interact with sprint mode"

    # Hierarchy: Epic > Sprint > Task
    hierarchy:
      epic: "High-level iteration cycle"
      sprint: "Implementation iteration within current epic"
      task: "Individual work items within sprint"

    # Sprint behavior within epic
    sprint_behavior:
      reset_sprints_on_new_epic: true     # Start fresh sprints on new epic
      preserve_sprint_learnings: true      # Keep sprint insights
      inherit_sprint_velocity: true        # Carry velocity estimates

    # Loop-back scope
    loop_back_scope:
      description: "Loop-back operates within current epic only"
      cross_epic_loop_back: false  # Cannot loop-back to previous epic

  # ============================================
  # Commands
  # ============================================
  commands:
    status: "/epic"                    # Show current epic status
    new: "/epic new"                   # Start new epic cycle
    set_count: "/epic set-count"       # Set total cycle count
    set_scope: "/epic set-scope"       # Set cycle scope
    history: "/epic history"           # View epic history
    archive: "/epic archive"           # View archived cycles

  # ============================================
  # Notifications
  # ============================================
  notifications:
    on_cycle_start:
      enabled: true
      message: "Starting Epic Cycle {current}/{total} - Scope: {start} -> {end}"

    on_cycle_complete:
      enabled: true
      message: "Epic Cycle {current} completed. Ready for next cycle or continue to next phase."

    on_final_cycle:
      enabled: true
      message: "Final Epic Cycle completed. Proceeding with remaining pipeline."

    mid_cycle_reminder:
      enabled: true
      trigger_at_stage: "03-planning"  # Remind at planning stage
      message: "Mid-cycle checkpoint: Review progress before continuing."

# ============================================
# Epic State Tracking (for progress.json)
# ============================================
#
# Add to progress.json:
#
# "epic_cycle": {
#   "enabled": true,
#   "current_cycle": 1,
#   "total_cycles": 2,
#   "scope": {
#     "start_stage": "01-brainstorm",
#     "end_stage": "05-task-management"
#   },
#   "completed_cycles": 0,
#   "cycle_start_time": null,
#   "modification_history": []
# },
# "epic_history": []
